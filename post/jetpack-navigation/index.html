<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Jetpack---Navigation | 小白记忆屋</title>
<meta name="description" content="温故而知新">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://ouluqiang.github.io//favicon.ico?v=1570429974105">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://ouluqiang.github.io//styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://ouluqiang.github.io/">
        <img src="https://ouluqiang.github.io//images/avatar.png?v=1570429974105" class="site-logo">
        <h1 class="site-title">小白记忆屋</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      温故而知新
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/ouluqiang" target="_blank">GITHUB</a> | <a class="rss" href="https://ouluqiang.github.io//atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Jetpack---Navigation</h2>
            <div class="post-date">2019-10-07</div>
            
            <div class="post-content">
              <article class="baidu_pl">
                <div id="article_content" class="article_content clearfix">
                                                <div class="article-copyright">
                <span class="creativecommons">
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
                    </a>
            <span>
                版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 BY-SA </a>版权协议，转载请附上原文出处链接和本声明。            </span>
               <div class="article-source-link2222">
                    本文链接：<a href="https://blog.csdn.net/lyhhj/article/details/93757755">https://blog.csdn.net/lyhhj/article/details/93757755</a>
                </div>
            </span>
                    </div>
                                                    <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
                                        <div id="content_views" class="markdown_views prism-dracula">
                    <!-- flowchart 箭头图标 勿删 -->
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                                            <h1><a name="t0"></a><a id="1__0"></a>1. 背景</h1>
<blockquote>
<p>之前已经翻译过了Google官方的CodeLabs上面的教程，教程很详细，代码在Github上也可以找到，本篇文章旨在自己的APP上使用效果及演示Demo，来具体的使用Navigation。并且对其进行源码解析。</p>
</blockquote>
<p>基本相关介绍可以查看我之前翻译的文章，基本就是google翻译了一个大概。</p>
<p><a href="https://juejin.im/post/5cf37caee51d45777621bb2b" rel="nofollow" data-token="83f24df062b64cdbe1d9a563b53f734d">一、Android Jetpack_Note_CodeLabs一Navigation</a></p>
<p><a></a></p>
<h1><a name="t1"></a><a id="2__11"></a>2. 基本使用</h1>
<blockquote>
<p>虽然在之前的文章中已经很详细的介绍了<code>Navigation</code>，但是这里也简单的叙述一下我在项目中的具体使用：</p>
</blockquote>
<p><a></a></p>
<h2><a name="t2"></a><a id="21_NavigationDrawerLayoutToolBar_17"></a>2.1 Navigation+DrawerLayout+ToolBar</h2>
<p>我们可以通过使用<code>Navigation</code> 配合<code>DrawerLayout</code>侧边栏和<code>Toolbar</code>标题来进行工作，不再需要我们去定义点击事件，也不需要我们去管理Fragment做切换，只需要我们做相关的配置和极少量的代码就可以了。</p>
<p><a></a></p>
<h3><a name="t3"></a><a id="211_DrawerLayout_22"></a>2.1.1 DrawerLayout</h3>
<p>侧边栏的用法和我们之前的使用一样，配置好我们<code>NavigationView</code>里面的<code>_headerLayout_</code><em>、</em><code>_menu_</code><em>即可；</em></p>
<blockquote>
<p>**注意：**这里面的menu有一点和我们之前的不一样，item的id必须要和navigation里面的fragment的id相同，否则点击事件不生效，这里先提一下，下面会详细介绍。</p>
</blockquote>
<p><a></a></p>
<h3><a name="t4"></a><a id="212_ToolBarNavHostFragment_29"></a>2.1.2 ToolBar和NavHostFragment</h3>
<p><code>DrawerLayout</code>配置好之后，我们再来配置标题栏，之前我们的用法都是在中间加一个存放<code>Fragment</code>的容器，有可能是<code>FrameLayout</code>、<code>ViewPager</code>等，这里面我们需要配置一个<code>Fragment</code>，这个<code>Fragment</code>的<strong>name</strong>是<code>androidx.navigation.fragment.NavHostFragment</code>，这是一个添加到布局中的特殊部件，<strong>NavHostFragment</strong>通过<strong>navGraph</strong>与<strong>navigation</strong>导航编辑器进行关联。具体代码如下：</p>
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.drawerlayout.widget.DrawerLayout</span>
            <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/drawer_layout<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>fitsSystemWindows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">tools:</span>openDrawer</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>start<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.appbar.AppBarLayout</span>
                    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
                    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
                    <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@style/AppTheme.AppBarOverlay<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<pre><code>            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;androidx.appcompat.widget.Toolbar&lt;/span&gt;
                    &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@+id/toolbar&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                    &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;layout_width&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;match_parent&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                    &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;layout_height&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;?attr/actionBarSize&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                    &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;background&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;?attr/colorPrimary&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                    &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;theme&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@style/AppTheme.PopupOverlay&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;

        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;com.google.android.material.appbar.AppBarLayout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;

        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;fragment&lt;/span&gt;
                &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@+id/fragment_home&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;androidx.navigation.fragment.NavHostFragment&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;layout_width&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;match_parent&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;layout_height&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;match_parent&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;app:&lt;/span&gt;defaultNavHost&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;true&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;app:&lt;/span&gt;navGraph&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@navigation/navigation_main&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;LinearLayout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;

    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;com.google.android.material.navigation.NavigationView&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;app:&lt;/span&gt;itemIconTint&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@color/nav_item_txt&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;app:&lt;/span&gt;itemTextColor&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@color/nav_item_txt&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@+id/nav_view&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;layout_width&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;wrap_content&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;layout_height&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;match_parent&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;layout_gravity&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;fitsSystemWindows&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;true&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;app:&lt;/span&gt;headerLayout&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@layout/nav_header_main&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;app:&lt;/span&gt;menu&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@menu/activity_main_drawer&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;androidx.drawerlayout.widget.DrawerLayout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
</code></pre>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li></ul></pre>
<p>我们可以看到<strong>NavHostFragment</strong>中有两个属性比较特殊：<code>app:defaultNavHost</code>和<code>app:navGraph="@navigation/navigation_main"</code>，前者就是是否是默认的其实页面，后者就是我们要设计的Navigation布局文件.</p>
<p><a></a></p>
<h3><a name="t5"></a><a id="213_navigation_mainxml_86"></a>2.1.3 navigation_main.xml</h3>
<p>在<code>Android Studio</code>3.2版本以上里面内嵌了<code>Navigation</code>的设计面板工具，我们可以在res文件夹下面的<code>navigation</code>文件里面对我们的fragment/Activity进行设计。</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAxOS9wbmcvMjc5NTA1LzE1NTk1NTM0NzQ3ODMtNzBlMGI3ODItNDNlYy00YTE3LTkyZTYtZTZkOWZmMDZmOTljLnBuZw#align=left&amp;display=inline&amp;height=152&amp;name=WeChatf84276a636246413fd559699a8c1e759.png&amp;originHeight=202&amp;originWidth=546&amp;size=27542&amp;status=done&amp;width=410" alt="WeChatf84276a636246413fd559699a8c1e759.png"></p>
<p>打开<strong>Desgin</strong>面板，进入设计模式，在里面我们可以新建我们的目标页面。如果你还没创建过一个**Destination，**你可以点击<code>create a destination</code>创建一个<code>Fragmengt/Activity</code>。当然如果你之前已经创建好了的话，在这里你可以直接选择：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAxOS9wbmcvMjc5NTA1LzE1NTk1NTM3MDU4ODQtNDNkYTg1ZGMtNmQ0OC00NmY0LWFmMjktOGRkZDQwMTZhZmVkLnBuZw#align=left&amp;display=inline&amp;height=429&amp;name=WeChat224344cdf31a9c4010f08da7cdf8f45e.png&amp;originHeight=858&amp;originWidth=1196&amp;size=147391&amp;status=done&amp;width=598" alt="WeChat224344cdf31a9c4010f08da7cdf8f45e.png"></p>
<p>选择完一个<strong>Destination</strong>之后，在面板中就可以看到了，具体的action、arguments就不介绍了，详细的可以看之前的文章。</p>
<p>打开<strong>Text</strong>模式的xml我们可以看到我们选择的Fragmengt配置信息，当然你也可以不通过面板设计，也可以直接在xml里进行代码编写。<br><code>startDestination</code>是APP默认启动的页面，这里面必须要指定，否则会报错crash。这里我的代码所指默认页面是<code>HomeFragment</code>，如下：</p>
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigation</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/navigation_main<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>startDestination</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/homeFragment<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UnusedNavigation<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<p><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span> <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/homeFragment<span class="token punctuation">&quot;</span></span><br>
<span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.hankkin.jetpack_note.ui.home.HomeFragment<span class="token punctuation">&quot;</span></span><br>
<span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@string/menu_home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><br>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@+id/action_navigationFragment_to_webFragment<span class="token punctuation">&quot;</span></span><br>
<span class="token attr-name"><span class="token namespace">app:</span>destination</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@id/webFragment<span class="token punctuation">&quot;</span></span><br>
<span class="token attr-name"><span class="token namespace">app:</span>enterAnim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@anim/slide_in_right<span class="token punctuation">&quot;</span></span><br>
<span class="token attr-name"><span class="token namespace">app:</span>exitAnim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@anim/slide_out_left<span class="token punctuation">&quot;</span></span><br>
<span class="token attr-name"><span class="token namespace">app:</span>popEnterAnim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@anim/slide_in_left<span class="token punctuation">&quot;</span></span><br>
<span class="token attr-name"><span class="token namespace">app:</span>popExitAnim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>@anim/slide_out_right<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><br>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fragment</span><span class="token punctuation">&gt;</span></span></p>
<pre><code>&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;fragment&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@+id/codeFragment&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;com.hankkin.jetpack_note.ui.CodeFragment&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;android:&lt;/span&gt;label&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@string/menu_code&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;
</code></pre>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre>
<p>我们可以看到上面的布局代码 默认的起始页面是homeFragment，下面还有一个codeFragment，其实这两个fragment也就是对应着在menu中的两个菜单，同时也对应我们侧边栏中的一个<strong>首页</strong>和一个<strong>代码页，</strong></p>
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
                <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/homeFragment<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/ic_menu_home<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@string/menu_home<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
                <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/codeFragment<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/ic_menu_code<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@string/menu_code<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre>
<blockquote>
<p>还记得上面说的id要相同吗？就是上面<strong>item的id</strong>要和<strong>navigation_main.xml</strong>中fragment的id相同，否则点击菜单不会切换fragment的。</p>
</blockquote>
<p>配置完上面这些信息之后，怎么将他们绑定起来使用呢？</p>
<p><a></a></p>
<h3><a name="t6"></a><a id="214_NavController_144"></a>2.1.4 NavController</h3>
<p>先看下代码：</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;">		navController <span class="token operator">=</span> Navigation<span class="token punctuation">.</span><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_home<span class="token punctuation">)</span>
        appBarConfiguration <span class="token operator">=</span> <span class="token function">AppBarConfiguration</span><span class="token punctuation">(</span><span class="token function">setOf</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>homeFragment<span class="token punctuation">,</span> R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>codeFragment<span class="token punctuation">)</span><span class="token punctuation">,</span> drawerLayout<span class="token punctuation">)</span>
        <span class="token comment">// Set up ActionBar</span>
        <span class="token function">setSupportActionBar</span><span class="token punctuation">(</span>mDataBinding<span class="token punctuation">.</span>toolbar<span class="token punctuation">)</span>
        <span class="token function">setupActionBarWithNavController</span><span class="token punctuation">(</span>navController<span class="token punctuation">,</span> appBarConfiguration<span class="token punctuation">)</span>
        <span class="token comment">// Set up navigation menu</span>
        mDataBinding<span class="token punctuation">.</span>navView<span class="token punctuation">.</span><span class="token function">setupWithNavController</span><span class="token punctuation">(</span>navController<span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre>
<ul>
<li>我们通过findNavController传入之前定义好的装载fragment的容器id（也就是之前定义的NavHostFragment）找到了Navigation对应的navController；</li>
<li>通过配置一个AppBarConfiguration，AppBarConfiguration 里传入了一个id的set集合和drawerlayout，id的集合就是我们在**navigation_main.xml **定义的fragment id</li>
<li>最后通过设置setupActionBarWithNavController、setupWithNavController进行关联绑定</li>
</ul>
<blockquote>
<p>到此，我们的基本配置就结束了，可以看到我们drawerlayout中的首页和代码按钮点击会切换对应的fragment，同时toolbar的汉堡按钮和返回按钮也会自动切换；当然Navigation还可以配合BottomNavigationView使用。</p>
</blockquote>
<p><a></a></p>
<h2><a name="t7"></a><a id="22_BottomNavigationView_166"></a>2.2 BottomNavigationView使用</h2>
<blockquote></blockquote>
<p><a></a></p>
<h3><a name="t8"></a><a id="221__172"></a>2.2.1 配置文件</h3>
<p>和上面的步骤类似：也是配置好 navigation.xml布局以及 BottomNavigationView所对应的menu菜单文件<br>
<a></a></p>
<h3><a name="t9"></a><a id="222_setupWithNavController_175"></a>2.2.2 setupWithNavController</h3>
<p>当然BottomNavigationView也提供了扩展方法setupWithNavController去绑定菜单和fragment，这里使用很简单就不具体介绍了。详情可见<a href="https://github.com/Hankkin/JetPack_Note/blob/master/app/src/main/java/com/hankkin/jetpack_note/ui/navigation/BottomNavSampleActivity.kt" rel="nofollow" data-token="d214b67f606ba22051f3edf75bd4eeb3">BottomNavSampleActivity</a>。</p>
<p><a></a></p>
<h2><a name="t10"></a><a id="23_Action_180"></a>2.3 Action跳转及传餐</h2>
<p><a></a></p>
<h3><a name="t11"></a><a id="231_Action_183"></a>2.3.1 Action跳转</h3>
<p>先看一下navigation的Desgin模式：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAxOS9wbmcvMjc5NTA1LzE1NTk2MzQ4MzIwNDUtMTZmYzY0ZWItOTI3MS00MTAwLWEyOTMtM2I4MDg5M2UzMWEzLnBuZw#align=left&amp;display=inline&amp;height=348&amp;name=image.png&amp;originHeight=695&amp;originWidth=747&amp;size=159060&amp;status=done&amp;width=374" alt="image.png"></p>
<p>可能你会注意到这些线是什么？没错这就是一个一个的<strong>Action</strong>，当你手动将两个Fragment进行连线后，在xml布局里面会对应生成一个标签，例如：</p>
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/action_dashBoardSampleFragment_to_notificationSampleFragment<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">app:</span>destination</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/notificationSampleFragment<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre>
<p><br>它会自动创建好id，id有可能比较长，但是确很清楚，从xtoy的模式，当然如果你不喜欢可以自己改，destination则是我们要跳转到的目标接界面。</p>
<p>action设置好了之后，我们可以执行下面代码进行跳转：</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>action_homeSampleFragment_to_dashBoardSampleFragment_action<span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>
<p><a></a></p>
<h3><a name="t12"></a><a id="232_NavOptions_204"></a>2.3.2 NavOptions切换动画</h3>
<p>当然fragment之间的切换是支持动画的，NavOptions是一个动画管理类，我们可以设置进入和回退的动画，设置的方式有两种：</p>
<ol>
<li>直接在标签中设置动画</li>
</ol>
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/action_homeSampleFragment_to_dashBoardSampleFragment_action<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">app:</span>destination</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/dashBoardSampleFragment<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">app:</span>enterAnim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@anim/slide_in_right<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">app:</span>exitAnim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@anim/slide_out_left<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">app:</span>popEnterAnim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@anim/slide_in_left<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">app:</span>popExitAnim</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@anim/slide_out_right<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre>
<ol start="2">
<li>通过NavOptions设置动画</li>
</ol>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">val</span> options <span class="token operator">=</span> navOptions <span class="token punctuation">{</span>
            anim <span class="token punctuation">{</span>
                enter <span class="token operator">=</span> R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>slide_in_right
                exit <span class="token operator">=</span> R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>slide_out_left
                popEnter <span class="token operator">=</span> R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>slide_in_left
                popExit <span class="token operator">=</span> R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>slide_out_right
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        view<span class="token punctuation">.</span>findViewById<span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>navigate_destination_button<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            <span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>flow_step_one_dest<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre>
<p><a></a></p>
<h3><a name="t13"></a><a id="233__236"></a>2.3.3 参数传递</h3>
<p>fragment之间的切换参数传递的方法也很简单，之前我们可能要通过宿主Activity或者接口等方法，总之挺麻烦的，下面我们看看通过Navigation控制的Fragment之间怎么传递？</p>
<p>我们可以在naviagtion布局中使用标签，</p>
<ul>
<li>name是我们传参的key</li>
<li>argType是参数类型</li>
<li>defaultValue默认值</li>
<li>nullable 是否可空</li>
</ul>
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>argument</span>
         <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deep_args<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">app:</span>argType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">android:</span>defaultValue</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">app:</span>nullable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre>
<blockquote>
<p>**注意：**当然type类型也支持我们自定的实体类，但是需要你填写类的全路径，同时你要保证实体类实现了序列化</p>
</blockquote>
<p>我们可以通过把参数传递封装到Bundle中，然后再执行navigate()方法时传递过去，例如：</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">val</span> args <span class="token operator">=</span> <span class="token function">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
args<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"link"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span>
args<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span>
it<span class="token punctuation">.</span><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>webFragment<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li></ul></pre>
<p>当然你在接受是也可以通过getArguments().getString(xxxx)这种方式去获取，但是Navigation组件还提供给了我们更简单的方式，当你设置了标签后，通过编译代码，会自动为我们生成一个<strong>XXXFragmentDirections</strong>类，它里面为我们作了参数的封装，而NavController的navigate()方法同时支持direction类型的传递。</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">val</span> direction <span class="token operator">=</span> HomeFragmentDirections<span class="token punctuation">.</span><span class="token function">actionNavigationFragmentToWebFragment</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span>title<span class="token punctuation">)</span>
it<span class="token punctuation">.</span><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>direction<span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre>
<p>同时在我们的目标页面所对应了一个XXXFragmentArgs，我们可以直接拿到navArgs()从这里我们可以直接拿到参数。</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">private</span> <span class="token keyword">val</span> args<span class="token operator">:</span> WebFragmentArgs <span class="token keyword">by</span> <span class="token function">navArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>
<p><a></a></p>
<h2><a name="t14"></a><a id="24_Deep_Link_283"></a>2.4 Deep Link</h2>
<p>关于Deep Link 是指跳入应用内的一个功能，我就把它翻译成深层链接了，Navigation提供了这样一个功能，使用起来也很简单：</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;">            <span class="token keyword">val</span> args <span class="token operator">=</span> <span class="token function">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            args<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"deep_args"</span><span class="token punctuation">,</span>et_deep_link<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> deep <span class="token operator">=</span> <span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createDeepLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDestination</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>notificationSampleFragment<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">createPendingIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<pre><code>        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; notificationManager &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
            context&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSystemService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NOTIFICATION_SERVICE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; NotificationManager
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Build&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;VERSION&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;SDK_INT &lt;span class=&quot;token operator&quot;&gt;&amp;gt;=&lt;/span&gt; Build&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;VERSION_CODES&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;O&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            notificationManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createNotificationChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;NotificationChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                    &lt;span class=&quot;token string&quot;&gt;&quot;deeplink&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Deep Links&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; NotificationManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;IMPORTANCE_HIGH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; builder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NotificationCompat&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Builder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            context&lt;span class=&quot;token operator&quot;&gt;!!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;deeplink&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setContentTitle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setContentText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Navigation 深层链接测试&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setSmallIcon&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mipmap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jetpack&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setContentIntent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;deep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAutoCancel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        notificationManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;notify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
</code></pre>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li></ul></pre>
<p>我们可以创建一个DeepLink，带上参数，通过Notification通知来测试这样的效果，可以直接跳到项目中的该页面。<br>具体可查看<a href="https://github.com/Hankkin/JetPack_Note/blob/master/app/src/main/java/com/hankkin/jetpack_note/ui/navigation/SampleNotificationFragment.kt" rel="nofollow" data-token="bfa972323cb16a5c7168bafb1ff07369">SampleNotificationFragment</a>。</p>
<p><a></a></p>
<h1><a name="t15"></a><a id="3__316"></a>3. 源码解析</h1>
<p><a></a></p>
<h3><a name="t16"></a><a id="31_NavHostFragment_319"></a>3.1 NavHostFragment</h3>
<blockquote>
<p>官网上是这样介绍它的：NavHostFragment provides an area within your layout for self-contained navigation to occur. 大致意思就是NavHostFragment在布局中提供了一个区域，用于进行包含导航</p>
</blockquote>
<p>接下来我们看一下它的源码：</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">public</span> <span class="token keyword">class</span> NavHostFragment extends Fragment implements NavHost <span class="token punctuation">{</span>
    <span class="token annotation builtin">@CallSuper</span>
    <span class="token annotation builtin">@Override</span>
    <span class="token keyword">public</span> void <span class="token function">onAttach</span><span class="token punctuation">(</span><span class="token annotation builtin">@NonNull</span> Context context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mDefaultNavHost<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">requireFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setPrimaryNavigationFragment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre>
<p>可以看到它就是一个<code>Fragment</code>，在<code>onAttach</code>生命周期开启事务将它自己设置成了PrimaryFragment了，当然通过<code>defaultNavHost</code>条件判断的，这个布尔值看着眼熟吗？没错，就是我们在xml布局中设置的那一个。</p>
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.signin(event)" style="position: unset;">					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
                    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/fragment_home<span class="token punctuation">"</span></span>
                    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>androidx.navigation.fragment.NavHostFragment<span class="token punctuation">"</span></span>
                    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
                    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
                    <span class="token attr-name"><span class="token namespace">app:</span>defaultNavHost</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
                    <span class="token attr-name"><span class="token namespace">app:</span>navGraph</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@navigation/navigation_main<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre>
<p>接着看它的<code>onCreate</code>生命周期</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;">    <span class="token annotation builtin">@CallSuper</span>
    <span class="token annotation builtin">@Override</span>
    <span class="token keyword">public</span> void <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation builtin">@Nullable</span> Bundle savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> Context context <span class="token operator">=</span> <span class="token function">requireContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<pre><code>    mNavController &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; new &lt;span class=&quot;token function&quot;&gt;NavController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    mNavController&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getNavigatorProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addNavigator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createFragmentNavigator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

   	&lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;navState &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Navigation controller state overrides arguments&lt;/span&gt;
        mNavController&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;restoreState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;navState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mGraphId &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Set from onInflate()&lt;/span&gt;
        mNavController&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setGraph&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mGraphId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// See if it was set by NavHostFragment.create()&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; Bundle args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getArguments&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; int graphId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KEY_GRAPH_ID&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; Bundle startDestinationArgs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
                &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBundle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KEY_START_DESTINATION_ARGS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;graphId &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            mNavController&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setGraph&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;graphId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; startDestinationArgs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
</code></pre>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li></ul></pre>
<p>我们看到在<code>onCreate</code>生命周期中创建了一个<code>NavController</code>，并且为这个<code>NavController</code>创建了一个<code>_Navigator_</code>_添加了进去，_我们跟踪<code>createFragmentNavigator</code>，发现它创建了一个<code>FragmentNavigator</code>，这个类是做什么的呢？它继承了Navigator，查看注释我们知道它是为每个Navigation设置策略的，也就是说Fragment之间通过导航切换都是由它来操作的，下面会详细介绍的，这里先简单看下。<br>接下来我们看到为<code>NavController</code>设置了<code>setGraph()</code>，也就是我们xml里面定义的<code>navGraph</code>，导航布局里面的<code>Fragment</code>及<code>action</code>跳转等信息。</p>
<p>还有就是onCreateView、onViewCreated等生命周期方法，基本就是加载布局设置ID的方法了。</p>
<p>下面我们跟到NavController.setGraph()中看下是怎样将我们设计的fragment添加进去的？</p>
<p><a></a></p>
<h3><a name="t17"></a><a id="32_NavController_395"></a>3.2 NavController</h3>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token comment">/**
     * Sets the {@link NavGraph navigation graph} to the specified graph.
     * Any current navigation graph data (including back stack) will be replaced.
     *
     * &lt;p&gt;The graph can be retrieved later via {@link #getGraph()}.&lt;/p&gt;
     *
     * @param graph graph to set
     * @see #setGraph(int, Bundle)
     * @see #getGraph
     */</span>
    <span class="token annotation punctuation">@CallSuper</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setGraph</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> NavGraph graph<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> Bundle startDestinationArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mGraph <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Pop everything from the old graph off the back stack</span>
            <span class="token function">popBackStackInternal</span><span class="token punctuation">(</span>mGraph<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mGraph <span class="token operator">=</span> graph<span class="token punctuation">;</span>
        <span class="token function">onGraphCreated</span><span class="token punctuation">(</span>startDestinationArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre>
<p>我们看如果设置的graph不为null，它执行了popBackStackInternal，看注释的意思为从之前的就的graph栈弹出所有的graph：</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">boolean</span> <span class="token function">popBackStackInternal</span><span class="token punctuation">(</span><span class="token annotation punctuation">@IdRes</span> <span class="token keyword">int</span> destinationId<span class="token punctuation">,</span> <span class="token keyword">boolean</span> inclusive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">boolean</span> popped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Navigator navigator <span class="token operator">:</span> popOperations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span><span class="token function">popBackStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mBackStack<span class="token punctuation">.</span><span class="token function">removeLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                popped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// The pop did not complete successfully, so stop immediately</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> popped<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li></ul></pre>
<p>果真remove掉了之前所有的naviagtor。而这个mBackStack是什么时候添加的navigator的呢？查看源码我们发现：</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> NavDestination node<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> Bundle args<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@Nullable</span> NavOptions navOptions<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> Navigator<span class="token punctuation">.</span>Extras navigatorExtras<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> popped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>navOptions <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>navOptions<span class="token punctuation">.</span><span class="token function">getPopUpTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                popped <span class="token operator">=</span> <span class="token function">popBackStackInternal</span><span class="token punctuation">(</span>navOptions<span class="token punctuation">.</span><span class="token function">getPopUpTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        navOptions<span class="token punctuation">.</span><span class="token function">isPopUpToInclusive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        Navigator<span class="token generics function"><span class="token punctuation">&lt;</span>NavDestination<span class="token punctuation">&gt;</span></span> navigator <span class="token operator">=</span> mNavigatorProvider<span class="token punctuation">.</span><span class="token function">getNavigator</span><span class="token punctuation">(</span>
                node<span class="token punctuation">.</span><span class="token function">getNavigatorName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Bundle finalArgs <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">addInDefaultArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        NavDestination newDest <span class="token operator">=</span> navigator<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> finalArgs<span class="token punctuation">,</span>
                navOptions<span class="token punctuation">,</span> navigatorExtras<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newDest <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果NavGraph不在栈内，先拿到父类Navgarph</span>
            ArrayDeque<span class="token generics function"><span class="token punctuation">&lt;</span>NavBackStackEntry<span class="token punctuation">&gt;</span></span> hierarchy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayDeque</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            NavGraph parent <span class="token operator">=</span> newDest<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                hierarchy<span class="token punctuation">.</span><span class="token function">addFirst</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NavBackStackEntry</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> finalArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                parent <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 现在遍历后堆栈并查看哪些导航图已经在栈内</span>
            Iterator<span class="token generics function"><span class="token punctuation">&lt;</span>NavBackStackEntry<span class="token punctuation">&gt;</span></span> iterator <span class="token operator">=</span> mBackStack<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>hierarchy<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                NavDestination destination <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDestination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>destination<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>hierarchy<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDestination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//destination 如果已经在栈顶，不需要再add了</span>
                    hierarchy<span class="token punctuation">.</span><span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Add all of the remaining parent NavGraphs that aren't</span>
            <span class="token comment">// already on the back stack</span>
            mBackStack<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>hierarchy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//添加新的 destination</span>
            NavBackStackEntry newBackStackEntry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NavBackStackEntry</span><span class="token punctuation">(</span>newDest<span class="token punctuation">,</span> finalArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mBackStack<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newBackStackEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>popped <span class="token operator">||</span> newDest <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dispatchOnDestinationChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li></ul></pre>
<p>还记得这个方法吗？我们一般手动切换Fragment时可以调用这个方法，最后就是跟踪到这里。</p>
<pre class="prettyprint"><code class="prism language-kotlin has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>bottomNavSampleActivity<span class="token punctuation">)</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>
<p>同时，切换目标Fragment到栈顶。我们发现最后<code>dispatchOnDestinationChanged()</code>这个方法，分发目标界面切换。有必要去跟一下，你可能会发现意想不到的东西：</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"> <span class="token comment">/**
     * Dispatch changes to all OnDestinationChangedListeners.
     * &lt;p&gt;
     * If the back stack is empty, no events get dispatched.
     *
     * @return If changes were dispatched.
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"WeakerAccess"</span><span class="token punctuation">)</span> <span class="token comment">/* synthetic access */</span>
    <span class="token keyword">boolean</span> <span class="token function">dispatchOnDestinationChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// We never want to leave NavGraphs on the top of the stack</span>
        <span class="token comment">//noinspection StatementWithEmptyBody</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>mBackStack<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> mBackStack<span class="token punctuation">.</span><span class="token function">peekLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDestination</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">NavGraph</span>
                <span class="token operator">&amp;&amp;</span> <span class="token function">popBackStackInternal</span><span class="token punctuation">(</span>mBackStack<span class="token punctuation">.</span><span class="token function">peekLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDestination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Keep popping</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mBackStack<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            NavBackStackEntry backStackEntry <span class="token operator">=</span> mBackStack<span class="token punctuation">.</span><span class="token function">peekLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>OnDestinationChangedListener listener <span class="token operator">:</span>
                    mOnDestinationChangedListeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                listener<span class="token punctuation">.</span><span class="token function">onDestinationChanged</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> backStackEntry<span class="token punctuation">.</span><span class="token function">getDestination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        backStackEntry<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li></ul></pre>
<p>这里面分发了所有实现了<code>OnDestinationChangedListener</code>接口的方法，继续跟踪，看看都哪些实现了这个接口呢？</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAxOS9wbmcvMjc5NTA1LzE1NTk2NjQwMDM5NDUtNGY2NWU4MjgtZWRlOC00M2VlLWI4NmItNjVlZmVkYzMwMTFhLnBuZw#align=left&amp;display=inline&amp;height=817&amp;name=image.png&amp;originHeight=817&amp;originWidth=1941&amp;size=315597&amp;status=done&amp;width=1941" alt="image.png"></p>
<p>只有一个类实现了<strong>AbstractAppBarOnDestinationChangedListener</strong>，看一下具体实现：</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestinationChanged</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> NavController controller<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NonNull</span> NavDestination destination<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> Bundle arguments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        DrawerLayout drawerLayout <span class="token operator">=</span> mDrawerLayoutWeakReference <span class="token operator">!=</span> null
                <span class="token operator">?</span> mDrawerLayoutWeakReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">:</span> null<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mDrawerLayoutWeakReference <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> drawerLayout <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            controller<span class="token punctuation">.</span><span class="token function">removeOnDestinationChangedListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        CharSequence label <span class="token operator">=</span> destination<span class="token punctuation">.</span><span class="token function">getLabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>TextUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            matcher<span class="token punctuation">.</span><span class="token function">appendTail</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置title</span>
            <span class="token function">setTitle</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">boolean</span> isTopLevelDestination <span class="token operator">=</span> NavigationUI<span class="token punctuation">.</span><span class="token function">matchDestinations</span><span class="token punctuation">(</span>destination<span class="token punctuation">,</span>
                mTopLevelDestinations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>drawerLayout <span class="token operator">==</span> null <span class="token operator">&amp;&amp;</span> isTopLevelDestination<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//设置icon</span>
            <span class="token function">setNavigationIcon</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//设置返回箭头状态</span>
            <span class="token function">setActionBarUpIndicator</span><span class="token punctuation">(</span>drawerLayout <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> isTopLevelDestination<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li></ul></pre>
<p>原来如此，到这里就应该清楚了，当我们切换Fragment时，大概流程如下：</p>
<ol>
<li>切换目标fragment到栈顶</li>
<li>分发目标Fragment切换状态</li>
<li>设置toolbar的标题、icon状态等</li>
<li>当然setTitle()、setNavigationIcon()等都为抽象方法，具体实现可以看子类里是怎么实现的，具体就不叙述了</li>
</ol>
<blockquote>
<p>到这里，基本的几个核心类以及相关实现我们基本了解了，下面我们看一下基本的流程，首先我们从入口进去，一点点跟进</p>
</blockquote>
<p><a></a></p>
<h3><a name="t18"></a><a id="33_NavigationfindNavControllerthis_Ridfragment_home_573"></a>3.3 Navigation.findNavController(this, R.id.fragment_home)</h3>
<p><a></a></p>
<h3><a id="_575"></a></h3>
<p>我们在最开始会初始化一个NavController：</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token annotation punctuation">@NonNull</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> NavController <span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> Activity activity<span class="token punctuation">,</span> <span class="token annotation punctuation">@IdRes</span> <span class="token keyword">int</span> viewId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        View view <span class="token operator">=</span> ActivityCompat<span class="token punctuation">.</span><span class="token function">requireViewById</span><span class="token punctuation">(</span>activity<span class="token punctuation">,</span> viewId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        NavController navController <span class="token operator">=</span> <span class="token function">findViewNavController</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> navController<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<p><span class="token annotation punctuation">@Nullable</span><br>
<span class="token keyword">private</span> <span class="token keyword">static</span> NavController <span class="token function">findViewNavController</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> View view<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>
<span class="token keyword">while</span> <span class="token punctuation">(</span>view <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>
NavController controller <span class="token operator">=</span> <span class="token function">getViewNavController</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span><br>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br>
<span class="token punctuation">}</span><br>
<span class="token keyword">return</span> null<span class="token punctuation">;</span><br>
<span class="token punctuation">}</span></p>
<p><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span><br>
<span class="token annotation punctuation">@Nullable</span><br>
<span class="token keyword">private</span> <span class="token keyword">static</span> NavController <span class="token function">getViewNavController</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> View view<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>
Object tag <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>nav_controller_view_tag<span class="token punctuation">)</span><span class="token punctuation">;</span><br>
NavController controller <span class="token operator">=</span> null<span class="token punctuation">;</span><br>
<span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token keyword">instanceof</span> <span class="token class-name">WeakReference</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>
controller <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>WeakReference<span class="token generics function"><span class="token punctuation">&lt;</span>NavController<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> tag<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token keyword">instanceof</span> <span class="token class-name">NavController</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>
controller <span class="token operator">=</span> <span class="token punctuation">(</span>NavController<span class="token punctuation">)</span> tag<span class="token punctuation">;</span><br>
<span class="token punctuation">}</span><br>
<span class="token keyword">return</span> controller<span class="token punctuation">;</span><br>
<span class="token punctuation">}</span></p>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li></ul></pre>
<p>查看代码可以看到是通过一个tag值来找到的，那么什么时候设置的呢？还记得3.1里面介绍的<code>NavHostFragment</code>的生命周期<code>onViewCreated</code>么？</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onViewCreated</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> View view<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> Bundle savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onViewCreated</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        View rootView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null <span class="token operator">?</span> <span class="token punctuation">(</span>View<span class="token punctuation">)</span> view<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> view<span class="token punctuation">;</span>
        Navigation<span class="token punctuation">.</span><span class="token function">setViewNavController</span><span class="token punctuation">(</span>rootView<span class="token punctuation">,</span> mNavController<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre>
<p>在视图创建的时候调用了<code>Naviagtion.setViewNavController()</code>。NavController初始化好了之后，接下来将它和<strong>NavigationView</strong>、<strong>ToolBar</strong>、<strong>BottomNavigationView</strong>、<strong>DrawerLayout</strong>进行绑定：</p>
<p><a></a></p>
<h3><a name="t20"></a><a id="34_setupActionBarWithNavController_625"></a>3.4 setupActionBarWithNavController</h3>
<p>不管是<code>NavigationView</code>还是<code>Bottom``NavigationView</code>，都会调用这个方法，他是<code>AppCompatActivity</code>的一个扩展方法，调用的是NavigationUI这个类：</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setupActionBarWithNavController</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> AppCompatActivity activity<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NonNull</span> NavController navController<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NonNull</span> AppBarConfiguration configuration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        navController<span class="token punctuation">.</span><span class="token function">addOnDestinationChangedListener</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">ActionBarOnDestinationChangedListener</span><span class="token punctuation">(</span>activity<span class="token punctuation">,</span> configuration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre>
<p>可以看到它就是调用了目标切换的那个接口，用来实现标题按钮等状态的改变。查看它的方法实现：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAxOS9wbmcvMjc5NTA1LzE1NTk2NjYyNjY1MjItMDFhOTc2YTEtN2I0Ni00OWMwLTljYzEtNmFlZjZjMjNlN2ZhLnBuZw#align=left&amp;display=inline&amp;height=697&amp;name=image.png&amp;originHeight=1393&amp;originWidth=1151&amp;size=265848&amp;status=done&amp;width=576" alt="image.png"></p>
<p>我们看到它重载了很多方法，包括我们上面提到的<strong>NavigationView</strong>、<strong>ToolBar</strong>、<strong>BottomNavigationView</strong>、<strong>DrawerLayout</strong>。这样就将组件的状态切换绑定起来了，当fragment切换时，上面提到的接口分发，去切换布局按钮等状态。</p>
<p><a></a></p>
<h3><a name="t21"></a><a id="35_navViewsetupWithNavControllernavController_645"></a>3.5 navView.setupWithNavController(navController)</h3>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setupWithNavController</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token keyword">final</span> NavigationView navigationView<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">final</span> NavController navController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        navigationView<span class="token punctuation">.</span><span class="token function">setNavigationItemSelectedListener</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">NavigationView<span class="token punctuation">.</span>OnNavigationItemSelectedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onNavigationItemSelected</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> MenuItem item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//目标页面是否被选中</span>
                        <span class="token keyword">boolean</span> handled <span class="token operator">=</span> <span class="token function">onNavDestinationSelected</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> navController<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>handled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">//切换菜单状态、关闭抽屉</span>
                            ViewParent parent <span class="token operator">=</span> navigationView<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token keyword">instanceof</span> <span class="token class-name">DrawerLayout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token punctuation">(</span><span class="token punctuation">(</span>DrawerLayout<span class="token punctuation">)</span> parent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeDrawer</span><span class="token punctuation">(</span>navigationView<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                BottomSheetBehavior bottomSheetBehavior <span class="token operator">=</span>
                                        <span class="token function">findBottomSheetBehavior</span><span class="token punctuation">(</span>navigationView<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>bottomSheetBehavior <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    bottomSheetBehavior<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>BottomSheetBehavior<span class="token punctuation">.</span>STATE_HIDDEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">return</span> handled<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> WeakReference<span class="token generics function"><span class="token punctuation">&lt;</span>NavigationView<span class="token punctuation">&gt;</span></span> weakReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>navigationView<span class="token punctuation">)</span><span class="token punctuation">;</span>
        navController<span class="token punctuation">.</span><span class="token function">addOnDestinationChangedListener</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">NavController<span class="token punctuation">.</span>OnDestinationChangedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestinationChanged</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> NavController controller<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@NonNull</span> NavDestination destination<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> Bundle arguments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        NavigationView view <span class="token operator">=</span> weakReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>view <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            navController<span class="token punctuation">.</span><span class="token function">removeOnDestinationChangedListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        Menu menu <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> size <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> h <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> h<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            MenuItem item <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            item<span class="token punctuation">.</span><span class="token function">setChecked</span><span class="token punctuation">(</span><span class="token function">matchDestination</span><span class="token punctuation">(</span>destination<span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li></ul></pre>
<p>最后就是状态切换了，当点击menu菜单或者目标Fragment切换的时候，改变状态。</p>
<p><a></a></p>
<h3><a name="t22"></a><a id="36__696"></a>3.6 遗留问题</h3>
<p><strong>遗留：<strong>还记得上面说的那个在设置menu菜单栏的item的ID要和navigation.xml里fragment的ID相同么？至于为什么要这么做，我们看上面的第一段代码：跟踪</strong>onNavDestinationSelected()：</strong></p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">onNavDestinationSelected</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> MenuItem item<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NonNull</span> NavController navController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Menu<span class="token punctuation">.</span>CATEGORY_SECONDARY<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span><span class="token function">setPopUpTo</span><span class="token punctuation">(</span><span class="token function">findStartDestination</span><span class="token punctuation">(</span>navController<span class="token punctuation">.</span><span class="token function">getGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        NavOptions options <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//TODO provide proper API instead of using Exceptions as Control-Flow.</span>
            navController<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre>
<p>我们看到最后还是调用navigate()方法,并且将MenuItem的ID作为参数传递过去：</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@IdRes</span> <span class="token keyword">int</span> resId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> Bundle args<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> NavOptions navOptions<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@Nullable</span> Navigator<span class="token punctuation">.</span>Extras navigatorExtras<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        NavDestination currentNode <span class="token operator">=</span> mBackStack<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">?</span> mGraph
                <span class="token operator">:</span> mBackStack<span class="token punctuation">.</span><span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDestination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentNode <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"no current navigation node"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@IdRes</span> <span class="token keyword">int</span> destId <span class="token operator">=</span> resId<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">//根据menu id查询目标页面</span>
        NavDestination node <span class="token operator">=</span> <span class="token function">findDestination</span><span class="token punctuation">(</span>destId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> String dest <span class="token operator">=</span> NavDestination<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span> destId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"navigation destination "</span> <span class="token operator">+</span> dest
                    <span class="token operator">+</span> <span class="token punctuation">(</span>navAction <span class="token operator">!=</span> null
                    <span class="token operator">?</span> <span class="token string">" referenced from action "</span> <span class="token operator">+</span> NavDestination<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span> resId<span class="token punctuation">)</span>
                    <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span>
                    <span class="token operator">+</span> <span class="token string">" is unknown to this NavController"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">navigate</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> combinedArgs<span class="token punctuation">,</span> navOptions<span class="token punctuation">,</span> navigatorExtras<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li></ul></pre>
<p><code>NavDestination node = findDestination(destId)</code>通过Menu Item的ID查询<strong>NavDestination：</strong><br>**</p>
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.signin(event)" style="position: unset;"><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"WeakerAccess"</span><span class="token punctuation">)</span> <span class="token comment">/* synthetic access */</span>
    NavDestination <span class="token function">findDestination</span><span class="token punctuation">(</span><span class="token annotation punctuation">@IdRes</span> <span class="token keyword">int</span> destinationId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> currentGraph<span class="token punctuation">.</span><span class="token function">findNode</span><span class="token punctuation">(</span>destinationId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<p><span class="token annotation punctuation">@Nullable</span><br>
<span class="token keyword">final</span> NavDestination <span class="token function">findNode</span><span class="token punctuation">(</span><span class="token annotation punctuation">@IdRes</span> <span class="token keyword">int</span> resid<span class="token punctuation">,</span> <span class="token keyword">boolean</span> searchParents<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>
NavDestination destination <span class="token operator">=</span> mNodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>resid<span class="token punctuation">)</span><span class="token punctuation">;</span><br>
<span class="token comment">// Search the parent for the NavDestination if it is not a child of this navigation graph</span><br>
<span class="token comment">// and searchParents is true</span><br>
<span class="token keyword">return</span> destination <span class="token operator">!=</span> null<br>
<span class="token operator">?</span> destination<br>
<span class="token operator">:</span> searchParents <span class="token operator">&amp;&amp;</span> <span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null <span class="token operator">?</span> <span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findNode</span><span class="token punctuation">(</span>resid<span class="token punctuation">)</span> <span class="token operator">:</span> null<span class="token punctuation">;</span><br>
<span class="token punctuation">}</span></p>
<div class="hljs-button signin" data-title="登录后复制"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li></ul></pre>
<p>而<strong>mNodes</strong>是一个SparseArrayCompat数组，而<strong>NavDestination</strong>中维护了navigation.xml中的每个fragment的相关信息：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAxOS9wbmcvMjc5NTA1LzE1NTk3MDQ2OTM5NjEtZjc0M2Y0ZTMtNDBhOS00ZWY4LWIwODMtMTFmMWMxZWExZGRlLnBuZw#align=left&amp;display=inline&amp;height=383&amp;name=image.png&amp;originHeight=765&amp;originWidth=1208&amp;size=377825&amp;status=done&amp;width=604" alt="image.png"></p>
<p>在初始化的时候通过<code>addDestination()</code>放到数组mNodes中，而mId则就是我们的MenuItem的ID，所以很清楚了吧。</p>
<p><a></a></p>
<h2><a name="t23"></a><a id="4__773"></a>4. 总结</h2>
<p><a></a></p>
<h3><a name="t24"></a><a id="41__775"></a>4.1 流程</h3>
<ol>
<li>考虑到我们开始如果直接从<strong>setupWithNavController</strong> 入口进行分析的话，可能不太容易找到怎么创建的graph布局中的fragment，以及<strong>NavHostFragment</strong>到底是什么，所以我们先分析了布局中的**NavHostFragment，<strong>我们发现为什么要在布局中声明了一个</strong>NavHostFragment，**它是用来做什么的，最后发现在它的生命周期中创建了一个NavController，并且添加了FragmentNavigator，同时setGraph了。</li>
<li>紧接着我们通过setGraph进入到了<strong>NavController</strong>类中，通过graph里面设置的初始fragment看到了切换栈内切换Fragment的代码。</li>
<li>在里面我们看到了熟悉的<code>navigate()</code>方法，在里面dispatchOnDestinationChanged()吸引了我的注意力，通过查找，发现切换Fragment之后，通过该方法去改变布局的状态，也就是OnDestinationChangedListener接口。</li>
<li>到这里基本的代码实现已经了解的差不多了，然后我回到了入口，通过初始化NavController，调用NavigationUI中的方法绑定<strong>NavigationView</strong>、<strong>ToolBar</strong>、<strong>BottomNavigationView</strong>、<strong>DrawerLayout</strong>等布局，在调用<code>navigate()</code>方法后，改变状态，整个流程就走通了。</li>
</ol>
<blockquote>
<p>可能有一些不合理的地方，望大家见谅，但是这是我此次的一个基本流程。</p>
</blockquote>
<p><a></a></p>
<h3><a id="_785"></a></h3>
<p><a></a></p>
<h3><a name="t26"></a><a id="42__787"></a>4.2 类图</h3>
<p><a href="http://lc-2hxprqvs.cn-n1.lcfile.com/55a8ef5cb455ed676f77/navigation.png" rel="nofollow" data-token="5d8a3dbdb67d617dc9eb8c5c238a921e"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAxOS9wbmcvMjc5NTA1LzE1NTk3MjgwNzI4MDEtZTRlMGMxOTUtZTRkMy00ODdjLTk0NjktYjZlZjc0YjU0OGZjLnBuZw#align=left&amp;display=inline&amp;height=560&amp;name=image.png&amp;originHeight=1024&amp;originWidth=1363&amp;size=146731&amp;status=done&amp;width=746" alt="image.png"></a></p>
<p><a></a></p>
<h3><a name="t27"></a><a id="43__792"></a>4.3 分析</h3>
<p><a></a></p>
<h4><a id="431_NavHostFragment_794"></a>4.3.1 <strong>NavHostFragment</strong></h4>
<p>我们在Activity的布局里面设置了<strong>NavHostFragment</strong>,同时设置了navGraph布局，经过上面的分析我们知道<strong>NavHostFragment</strong>中新建了NavController,并且创建了用来管理Fragment事务及切换的<strong>FragmentNavigator</strong>，可以简单的把它理解成连接Fragment和NavController的一个桥梁，同时也提供了包含导航的容器布局。</p>
<p><a></a></p>
<h4><a id="432_NavController_799"></a>4.3.2 NavController</h4>
<p>NavContorller是整个导航组件的核心，通过它来加载xml中fragment节点转化成<strong>NavDestination</strong>，并保存在栈内，通过navigate()方法切换栈内NavDestination，以做到fragment的切换操作。同时当fragment切换后，下发<strong>OnDestinationChanged</strong>接口，来改变NavgationView、BottomNavgationView、Menu等相关UI操作。</p>
<p><a></a></p>
<h4><a id="433_NavigationUI_804"></a>4.3.3 NavigationUI</h4>
<p>通过NavgationUI类，为各个View设置接口监听，将View的UI状态和NavController中的切换Fragment做了绑定。</p>
<blockquote>
<p>到这里整个Navgation组件的源码分析就结束了，大概的流程已经很清晰了，当然没有做到百分百，比如Deep Link部分，感兴趣的可以自行看一下，可以按照这个思路去真的看一下源码，看完之后你真的会对Navgation组件有更深的理解。当然你也可以参考CodeLabs中的Demo以及文档，也可以看我的Jepack_Note的代码，如有不对的地方，还望指出，谅解.</p>
</blockquote>
<pre><code>                                &lt;/div&gt;
            &lt;link href=&quot;https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-095d4a0b23.css&quot; rel=&quot;stylesheet&quot;&gt;
                &lt;/div&gt;
&lt;/article&gt;</code></pre>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://ouluqiang.github.io//post/kotlin-ji-chu">
                  <h3 class="post-title">
                    kotlin基础
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '4cb03ab310ad62ef1078',
        clientSecret: '8c04030bf365023e81c4ae9481977a50a8bd4765',
        repo: 'ouluqiang.github.io',
        owner: 'ouluqiang',
        admin: ['ouluqiang'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
